## *This is a docker image for a Postgres sql db*

Build an image from the Dockerfile and assign it a name.

```shell script
$ docker build -t eg_postgresql .
```

Run the PostgreSQL server container (in the foreground):
```shell script
$ docker run --rm -P --name pg_test eg_postgresql

or 

docker run --rm -p 6432:5432  --name pg_test eg_postgresql
```


There are two ways to connect to the PostgreSQL server. 

We can use Link Containers, or we can access it from our host (or the network).

__The --rm removes the container and its image when the container exits successfully.__

## Use container linking

Containers can be linked to another container’s ports directly using `--link remote_name:local_alias`  in the client’s docker run. 

This sets a number of environment variables that can then be used to connect:

```shell script
$ docker run --rm -t -i --link pg_test:pg eg_postgresql bash
```

```shell script
postgres@7ef98b1b7243:/$ psql -h $PG_PORT_5432_TCP_ADDR -p $PG_PORT_5432_TCP_PORT -d docker -U docker --password
```
## Connect from your host system
Assuming you have the postgresql-client installed, you can use the host-mapped port to test as well. 

You need to use docker ps to find out what local host port the container is mapped to first:

```shell script
$ docker ps

CONTAINER ID        IMAGE                  COMMAND                CREATED             STATUS              PORTS                                      NAMES
5e24362f27f6        eg_postgresql:latest   /usr/lib/postgresql/   About an hour ago   Up About an hour    0.0.0.0:49153->5432/tcp                    pg_test

```

```shell script
$ psql -h localhost -p 49153 -d docker -U docker --password
```
## Test the database
Once you have authenticated and have a docker =# prompt, you can create a table and populate it.

## Use Volumes
```shell script
psql (9.3.1)
Type "help" for help.

$ docker run --rm --volumes-from pg_test -t -i busybox sh

/ # ls
bin      etc      lib      linuxrc  mnt      proc     run      sys      usr
dev      home     lib64    media    opt      root     sbin     tmp      var
/ # ls /etc/postgresql/9.3/main/
environment      pg_hba.conf      postgresql.conf
pg_ctl.conf      pg_ident.conf    start.conf
/tmp # ls /var/log
ldconfig    postgresql
```
##Create a Directory to Serve as the Local Host Mount Point for Postgres Data Files

If we want to persist data generated by the Postgres instance running inside a container beyond the container’s lifecycle, we need to map a local mount point as a data volume to an appropriate path inside the container. 

Typically I create a volumes folder (we can give the folder any name we like) in my home directory and then create subfolders for each of the applications I need to create data volume mount points for.

```shell script
mkdir -p $HOME/docker/volumes/postgres
```

## Run the Postgres Container
Starting the Postgres container is as simple as running the docker run command

```shell script
docker run --rm   --name pg-docker -e POSTGRES_PASSWORD=docker -d -p 6432:5432 -v $HOME/docker/volumes/postgres:/var/lib/postgresql/data  postgres

```


